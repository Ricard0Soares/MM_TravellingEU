<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../styles/navBar.css">
       <link rel="stylesheet" type="text/css" href="../styles/cidade.css">

</head>

<body>
    <nav class="navbar">
        <div class="logo"><a href="home.html">TravellingEU</a></div>
        <ul class="nav-links">
          <li><a href="../screens/navLinks/destinations.html">Destinations</a></li>
          <li><a href="../screens/videos/videos.html">Videos</a></li>
          <li><a href="../screens/navLinks/howitworks.html">How it works</a></li>
          <li><a href="../screens/navLinks/aboutus.html">About Us</a></li>
        </ul>
    </nav>

    <div class="ellipse-container">
        <p>Madrid</p>
        <div class="image-container">
            <img src="../images/madrid.jpg" alt="madrid">
            <span>Madrid é a capital e a maior cidade da Espanha. Tem 3 305 408 habitantes e a sua área metropolitana cerca
              de 6,8 milhões de habitantes. É a segunda maior cidade da União Europeia, depois de Berlim, e sua área metropolitana 
              é a segunda maior da UE, depois de Paris. </span>
        </div>
    </div>

    <div class="second-ellipse-container">

      <div id="overlayArea" class="overlay-area"></div>
      

        <div id="video-container" class="video-container">
            <video id="myVideo" controls muted>
                <source src="../videos/madrid.mp4" type="video/mp4">
            </video>
            
            <canvas id="overlayCanvas"></canvas>

            <div id="overlay" class="overlay">
                <a href="#" id="link1" style="top: 10%; left: 10%;">Learn more about Lisbon</a>
                <a href="#" id="link2" style="top: 20%; left: 20%;">Learn more about Paris</a>
            </div>


            <div id="infoCard" class="info-card"></div>
            
            <!--<div id="cardContainer" class="card-container">
                <h2 id="cardTitle">Mosteiro dos Jerónimos</h2>
                <p id="cardDescription">Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
                    Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown 
                    printer took a galley of type and scrambled it to make a type specimen book. It has survived 
                    not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. 
                    It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and 
                    more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
                <ul class="image-list">
                    <li><img src="images/image_3.png" alt="cidade1"></li>
                    <li><img src="images/image_4.png" alt="cidade2"></li>
                    <li><img src="images/image_5.png" alt="cidade3"></li>
                </ul>
            </div>-->

            <div id="cardContainer" class="card-container">
              <span id="closeCard" class="close-button">&times;</span>
              <h2 id="cardTitle"></h2>
              <p id="cardDescription"></p>
              <ul class="image-list">
                  <li><img src="images/image_3.png" alt="cidade1"></li>
                  <li><img src="images/image_4.png" alt="cidade2"></li>
                  <li><img src="images/image_5.png" alt="cidade3"></li>
              </ul>
          </div>

        </div>

        <div id="thumbnails" class="thumbnails"></div>
        
    </div>

    
    <script>

         
      // Seleciona os elementos relevantes
      const cardContainer = document.getElementById('cardContainer');
      const secondEllipseContainer = document.querySelector('.second-ellipse-container');
      const overlayArea = document.getElementById('overlayArea');
      const myVideo = document.getElementById('myVideo');
      const closeCardButton = document.getElementById('closeCard');

      // Função para abrir o cardContainer e desfocar o second-ellipse-container
      function openCardContainer() {
          cardContainer.style.display = 'block';
          secondEllipseContainer.classList.add('blur'); 
          myVideo.classList.add('blur');
      }
      // Função para fechar o cardContainer e remover o desfoque
      function closeCardContainer() {
          cardContainer.style.display = 'none';
          secondEllipseContainer.classList.remove('blur');
          myVideo.classList.remove('blur');
      }

      // Evento para abrir o cardContainer quando overlayArea é clicada
overlayArea.addEventListener('click', openCardContainer);

// Evento para fechar o cardContainer quando o botão de fechar é clicado
closeCardButton.addEventListener('click', closeCardContainer);

        document.addEventListener("DOMContentLoaded", () => {

          const video = document.getElementById("myVideo");
          const canvas = document.createElement("canvas");
          const overlay = document.getElementById('overlay');
          const thumbnailsContainer = document.getElementById("thumbnails");
          const ctx = canvas.getContext("2d");
          const thumbnailWidth = 300;
          const thumbnailHeight = 120;
          const listOfMonuments = ['Torre de Belém', 'Torre de Belém', 'Parque das Nações', 'Parque das Nações', 'teste5', 'Padrão dos Descobrimentos'];
          var counter = 0;
          var currentActiveCard = null;

          const infoCard = document.getElementById('infoCard');
          const cardContainer = document.getElementById('cardContainer');
          const link1 = document.getElementById('link1');
          const overlayArea = document.getElementById('overlayArea');

          const cardTitleElement = document.getElementById('cardTitle');
          const cardDescriptionElement = document.getElementById('cardDescription');
          

          video.currentTime = 0;
      
          detectChanges();
      
          //thumbnails
          function createCard(targetDivId, frame) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            cardDiv.style.width = '8rem';
            cardDiv.style.height = '6rem';
            cardDiv.style.background = 'none';
      
            frame.className = 'card-img-top';
      
            const cardBodyDiv = document.createElement('div');
            cardBodyDiv.className = 'card-body';
            cardBodyDiv.style.textAlign = 'center';
            cardBodyDiv.style.padding = '0.1rem'; // Adjust padding to reduce space
      
            const cardText = document.createElement('p');
            cardText.className = 'card-text';
            cardText.style.color = 'yellow';
            cardText.style.marginTop = '0.1rem'; // Adjust margin to reduce space
            cardText.style.fontSize = '12px';
            cardText.textContent = listOfMonuments[counter];
      
            cardDiv.appendChild(frame);
            cardBodyDiv.appendChild(cardText);
            cardDiv.appendChild(cardBodyDiv);
      
            const targetDiv = document.getElementById(targetDivId);
            targetDiv.appendChild(cardDiv);
      
            counter = (counter + 1) % listOfMonuments.length;
    
            //click event listener to highlight the card
            cardDiv.addEventListener("click", () => {
              video.currentTime = frame.getAttribute('data-time');
              video.play();
      
              //highlight active card
              if (currentActiveCard) {
                currentActiveCard.classList.remove('active-card');
              }
              cardDiv.classList.add('active-card');
              currentActiveCard = cardDiv;
            });
          }
      
          // Generate a thumbnail at a specific time
          function generateThumbnail(time) {
            return new Promise((resolve) => {
              video.currentTime = time;
              video.addEventListener('seeked', function captureFrame() {
                ctx.drawImage(video, 0, 0, thumbnailWidth, thumbnailHeight);
                const dataURL = canvas.toDataURL();
                const imageData = ctx.getImageData(0, 0, thumbnailWidth, thumbnailHeight).data;
                video.removeEventListener('seeked', captureFrame);
                resolve({ dataURL, time, imageData });
              }, { once: true });
            });
          }
      
          // Detect significant changes in frames
          async function detectChanges() {
            let lastImageData = null;
            const interval = 1; // seconds
      
            video.addEventListener('loadeddata', async () => {
              const duration = video.duration;
              for (let t = 0; t < duration; t += interval) {
                const { dataURL, time, imageData } = await generateThumbnail(t);
                const img = new Image();
                img.src = dataURL;
                img.width = thumbnailWidth;
                img.height = thumbnailHeight;
                img.classList.add("thumbnail");
                img.setAttribute('data-time', time);
      
                if (!lastImageData) {
                  createCard('thumbnails', img);
                  lastImageData = imageData;
                } else {
                  if (hasSignificantChange(lastImageData, imageData)) {
                    createCard('thumbnails', img);
                    lastImageData = imageData;
                  }
                }
              }
              video.currentTime = 0;

              
            });
          }
      
          // Compare two frames for significant changes
          function hasSignificantChange(data1, data2) {
            let changedPixels = 0;
            const threshold = 100; // change threshold per pixel
            const maxChangedPixels = 0.6 * data1.length / 4;
      
            for (let i = 0; i < data1.length; i += 4) {
              const diff = Math.abs(data1[i] - data2[i]) + Math.abs(data1[i + 1] - data2[i + 1]) + Math.abs(data1[i + 2] - data2[i + 2]);
      
              if (diff > threshold) {
                changedPixels++;
              }
            }
      
            return changedPixels > maxChangedPixels;
          }


        video.addEventListener('timeupdate', () => {
          const currentTime = video.currentTime;

          if (currentTime >= 0 && currentTime < 4) {
            document.getElementById('link1').style.display = 'block';
            document.getElementById('link2').style.display = 'none';
            overlay.style.display = 'block';

            cardTitleElement.textContent = "Mosteiro dos Jerónimos";
            cardDescriptionElement.textContent = "Lorem Ipsum is simply dummy text of the printing and typesetting industry.\n\n" +
                  "Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived\n" +
                  "not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.\n\n" +
                  "It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and\n" +
                  "more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.";


            positionOverlayArea('5%','33%','20%','40%', 'block');


          } else if (currentTime >= 4 && currentTime < 8) {
              document.getElementById('link1').style.display = 'none';
              document.getElementById('link2').style.display = 'block';
              overlay.style.display = 'block';

              cardTitleElement.textContent = "Parque das Nações";
              cardDescriptionElement.textContent = "teste2";

              positionOverlayArea('10%','20%','40%','40%', 'block');

          }else if(currentTime >= 8 && currentTime < 11){
              cardTitleElement.textContent = "Não faço ideia";
              cardDescriptionElement.textContent = "teste3";

              positionOverlayArea('10%','20%','40%','40%', 'block');

          }else if(currentTime >= 11 && currentTime < 15){
              cardTitleElement.textContent = "Não faço ideia1";
              cardDescriptionElement.textContent = "teste4";

              positionOverlayArea('10%','10%','60%','30%', 'block');

          }else if(currentTime >= 15 && currentTime < 19){
              cardTitleElement.textContent = "Padrão dos Descobrimentos";
              cardDescriptionElement.textContent = "teste2";

              positionOverlayArea('10%','25%','20%','40%', 'block');

          }else if(currentTime >= 19 && currentTime <= 22){
              cardTitleElement.textContent = "Padrão dos Descobrimentos1";
              cardDescriptionElement.textContent = "teste2";

              positionOverlayArea('15%','35%','10%','40%', 'block');

          } else {
              overlay.style.display = 'none';
              overlayArea.style.display = 'none';
          }
        });


        function positionOverlayArea(top ,left ,width ,height ,display){
          overlayArea.style.top = top;
          overlayArea.style.left = left;
          overlayArea.style.width = width;
          overlayArea.style.height = height;
          overlayArea.style.display = display;
          
        }

        // Add hover functionality for overlayArea
        overlayArea.addEventListener('mouseenter', (event) => {

          let hoverMessageText = "";
          const currentTime = video.currentTime;

          if (currentTime >= 0 && currentTime < 4) {
              hoverMessageText = "Torre de Belém";
          } else if (currentTime >= 4 && currentTime < 8) {
              hoverMessageText = "Parque das Nações";
          } else if (currentTime >= 8 && currentTime < 11) {
              hoverMessageText = "Não faço ideia";
          } else if (currentTime >= 11 && currentTime < 15) {
              hoverMessageText = "Não faço ideia1";
          } else if (currentTime >= 15 && currentTime < 19) {
              hoverMessageText = "Padrão dos Descobrimentos";
          } else if (currentTime >= 19 && currentTime <= 22) {
              hoverMessageText = "Padrão dos Descobrimentos1";
          }

          showHoverMessage(event, hoverMessageText);
        });

        overlayArea.addEventListener('mouseleave', () => {
          hideHoverMessage();
        });

        overlayArea.addEventListener('click', () => {
          cardContainer.style.display = 'block';
          video.pause();
        });

        function showHoverMessage(event, message) {
          const hoverMessage = document.createElement('div');
          hoverMessage.textContent = message;
          hoverMessage.classList.add('hover-message');
          document.body.appendChild(hoverMessage);

          updateHoverMessagePosition(event);

        function updateHoverMessagePosition(event) {
          hoverMessage.style.top = event.clientY + 'px';
          hoverMessage.style.left = event.clientX + 'px';
        }

        document.addEventListener('mousemove', updateHoverMessagePosition);

          setTimeout(() => {
            hoverMessage.remove();
            document.removeEventListener('mousemove', updateHoverMessagePosition);
          }, 5000);
        }

        function hideHoverMessage() {
          const hoverMessage = document.querySelector('.hover-message');
          if (hoverMessage) {
            hoverMessage.remove();
          }
        }

        // Add click event for "Learn more about Lisbon"
        link1.addEventListener('click', (event) => {
          event.preventDefault();
          cardContainer.style.display = 'block';
          video.pause();
        });

        // Hide cardContainer and play video when video is clicked
        video.addEventListener('play', () => {
          cardContainer.style.display = 'none';
        });

      });

            
    </script>
    
      

</body>
</html>
