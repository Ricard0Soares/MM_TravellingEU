<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="porto.css">
    <link rel="stylesheet" type="text/css" href="navBar.css">

    <style>
        #thumbnails{
            display:flex;
            flex-wrap: wrap;
        }

        .thumbnail{
            margin: 5px;
            cursor: pointer;
        }
    </style>

</head>

<body>
    <nav class="navbar">
        <div class="logo"><a href="home.html">TravellingEU</a></div>
        <ul class="nav-links">
            <li><a href="screens/navLinks/destinations.html">Destinations</a></li>
            <li><a href="screens/videos/videos.html">Videos</a></li>
            <li><a href="screens/navLinks/howitworks.html">How it works</a></li>
            <li><a href="screens/navLinks/aboutus.html">About Us</a></li>
        </ul>
    </nav>

    <div class="ellipse-container">
        <p>Porto</p>
        <div class="image-container">
            <img src="images/porto.png" alt="porto">
            <span>Porto é cidade vibrante e histórica situada no noroeste de Portugal, nas margens do rio Douro, 
                capital da sub-região da Área Metropolitana do Porto e da região do Norte. Tem uma população estimada 
                de 231 962 habitantes e uma área de 41.42 km quadrados</span>
        </div>
    </div>

    <div class="second-ellipse-container">
        <div class="video-container">
            <video id="myVideo" controls muted>
                <source src="lisboa.mp4" type="video/mp4">
            </video>
            <div id="overlay" class="overlay">
                <a href="home.html" id="link1" style="top: 10%; left: 10%;">Learn more about Porto</a>
                <a href="paris.html" id="link2" style="top: 20%; left: 20%;">Learn more about Paris</a>
            </div>
            <div id="thumbnails" class="thumbnails">
                
            </div>
        </div>
    </div>

    <div class="third-ellipse-container">
        <div class="photos-container">
            <img src="images/image_3.png" alt="cidade1">
        </div>
        <div class="photos-container">
            <img src="images/image_4.png" alt="cidade2">
        </div>
        <div class="photos-container">
            <img src="images/image_5.png" alt="cidade3">
        </div>
        <div class="photos-container">
            <img src="images/image_3.png" alt="cidade5">
        </div>
        <div class="photos-container">
            <img src="images/image_4.png" alt="cidade6">
        </div>
    </div>
    
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
        const overlay = document.getElementById('overlay');
        const video = document.getElementById("myVideo");
        const thumbnailsContainer = document.getElementById("thumbnails");
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const thumbnailWidth = 160;
        const thumbnailHeight = 90;

        detectChanges();

        // Generate a thumbnail at a specific time
        function generateThumbnail(time) {
            return new Promise((resolve) => {
                video.currentTime = time;
                video.addEventListener('seeked', function captureFrame() {
                    ctx.drawImage(video, 0, 0, thumbnailWidth, thumbnailHeight);
                    const dataURL = canvas.toDataURL();
                    const imageData = ctx.getImageData(0, 0, thumbnailWidth, thumbnailHeight).data;
                    video.removeEventListener('seeked', captureFrame);
                    resolve({ dataURL, time, imageData });
                }, { once: true });
            });
        }

        // Detect significant changes in frames
        async function detectChanges() {
            let lastImageData = null;
            const interval = 1; // seconds

            video.addEventListener('loadeddata', async () => {
                const duration = video.duration;
                for (let t = 0; t < duration; t += interval) {
                    const { dataURL, time, imageData } = await generateThumbnail(t);
                    const img = new Image();
                    img.src = dataURL;
                    img.width = thumbnailWidth;
                    img.height = thumbnailHeight;
                    img.classList.add("thumbnail");

                    img.addEventListener("click", () => {
                        video.currentTime = time;
                        video.play();
                    });

                    if (!lastImageData) {
                        thumbnailsContainer.appendChild(img);
                        lastImageData = imageData;
                    } else {
                        if (hasSignificantChange(lastImageData, imageData)) {
                            thumbnailsContainer.appendChild(img);
                            lastImageData = imageData;
                        }
                    }
                }
                video.currentTime = 0;
            });
        }

        // Compare two frames for significant changes
        function hasSignificantChange(data1, data2) {
            let changedPixels = 0;
            const threshold = 100; // change threshold per pixel
            const maxChangedPixels = 0.3 * data1.length / 4; // 2% of the pixels

            for (let i = 0; i < data1.length; i += 4) {
                const diff = Math.abs(data1[i] - data2[i])
                            + Math.abs(data1[i + 1] - data2[i + 1])
                            + Math.abs(data1[i + 2] - data2[i + 2]);

                if (diff > threshold) {
                    changedPixels++;
                }
            }

            return changedPixels > maxChangedPixels;
        }

        // Show overlays at specific time intervals
        video.addEventListener('timeupdate', () => {
            const currentTime = video.currentTime;

            if (currentTime >= 5 && currentTime < 10) {
                document.getElementById('link1').style.display = 'block';
                document.getElementById('link2').style.display = 'none';
                overlay.style.display = 'block';
            } else if (currentTime >= 10 && currentTime < 15) {
                document.getElementById('link1').style.display = 'none';
                document.getElementById('link2').style.display = 'block';
                overlay.style.display = 'block';
            } else {
                overlay.style.display = 'none';
            }
        });
    });




    </script>

</body>
</html>
